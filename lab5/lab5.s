; vim: set filetype=asmhc12:

#INCLUDE ../HC12TOOLS.INC
;#INCLUDE ../KEYPAD_IO.INC
;#INCLUDE ../LCD_IO.INC

	ORG $1000

COUNTER	DS.B 1
PROMPT 	DC.B "Loopy.",CR,LF,NULL

	ORG $2000

MAIN:

	BSET PWMCTL,#%11000000 ;concatenate 4 and 5, and 6 and 7
	BSET PWMPOL,#%11110000 ;CHANNEL 4/5, 6/7 ACTIVE HIGH
	BCLR PWMCLK,#%11110000 ;CHANNEL 4/5, 6/7 CLOCK A 
				;(0 = A or B ; 1 = SA or SB)
	MOVB #$00,PWMPRCLK ;PWM CLOCK A SCALE=1

;697 Hz -> (1/697)/(0.00000004167) cycles = 34430.531... cycles

	MOVW #34430,PWMPER4 ;PWM CHANNEL 4/5 PERIOD
	MOVW #17215,PWMDTY4 ;PWM CHANNEL 4/5 DUTY CYCLE

	MOVW #14696,PWMPER6 ; PWM CHANNEL 6/7 period
	MOVW #7348,PWMDTY6 ; PWM CHANNEL 6/7 duty

LOOPY:

	PUTS_SCI0 #PROMPT
	JSR ENABLE
	DELAY_BY_MS #500
	JSR DISABLE
	DELAY_BY_MS #500
	BRA LOOPY

ENABLE:

	BSET PWME,#%11110000    ;ENABLE PWM CHANNEL 4/5,6/7
	RTS

DISABLE:

	BCLR PWME,#%11110000    ;Disable PWM CHANNEL 4/5,6/7
	RTS
